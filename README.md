Versión final corregida con validación funcional y sin errores de indentación.